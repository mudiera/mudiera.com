<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mudiera | Business Directory</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- PLACEHOLDER TRACKING SCRIPTS - UNCOMMENT AND ADD KEYS WHEN READY
    <meta name="google-site-verification" content="GOOGLE_SITE_VERIFICATION_TOKEN">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
    </script>
    <script>
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "CLARITY_PROJECT_ID");
    </script>
    -->
    <link rel="stylesheet" href="style.css?v=3">
    <!-- Load Data Object directly to avoid CORS issues locally -->
    <script src="businesses_data.js"></script>
</head>
<body>

    <header class="site-header">
        <div class="container header-inner">
            <div class="logo-area">
                <a href="index.html" class="logo">MUDIERA</a>
                <p class="tagline">The London Edition</p>
            </div>
            <button class="nav-toggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <a href="https://forms.gle/xkeWJgE3K4SjjJht7" class="add-listing-btn" target="_blank">Add My Listing</a>
            <nav class="main-nav">
                <ul class="nav-list">
                    <li><a href="directory.html" class="nav-link">Home</a></li>
                    <li><a href="categories.html" class="nav-link">Categories</a></li>
                    <li><a href="events.html" class="nav-link">Events</a></li>
                    <li><a href="subscribe.html" class="nav-link">Subscribe</a></li>
                    <li><a href="about.html" class="nav-link">About Us</a></li>
                    <li><a href="careers.html" class="nav-link">Careers</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero-block">
        <div class="container">
            <!-- Mobile "Add My Listing" button moved here -->
            <a href="https://forms.gle/xkeWJgE3K4SjjJht7" class="add-listing-btn mobile-only-btn" target="_blank">Add My Listing</a>
            <h1 class="hero-title">Directory</h1>
        </div>
    </section>

    <section class="filter-block">
        <div class="container">
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="Search businesses, services, or products...">
                <input type="text" id="postcodeInput" class="search-input" placeholder="Enter Postcode (Optional)" style="margin-top: 10px;">
            </div>

            <div class="category-pills" id="categoryFilters">
                <button class="pill active">All</button>
                <button class="pill">Health & Beauty</button>
                <button class="pill">Food & Drinks</button>
                <button class="pill">Services</button>
                <button class="pill">Shopping</button>
                <button class="pill">Community</button>
                <button class="pill">Events</button>
            </div>
        </div>
    </section>

    <section class="grid-block">
        <div class="container card-grid" id="businessGrid">
            <!-- Content will be populated by JS -->
        </div>
    </section>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <h3>MUDIERA</h3>
                    <p>The first ever Muslim womenâ€™s digital ecosystem bringing together halal aligned brands, services, and opportunities.</p>
                </div>
                <div>
                    <h4 class="footer-heading">Sections</h4>
                    <ul class="footer-links">
                        <li><a href="categories.html">Categories</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="directory.html">Home</a></li>
                        <li><a href="subscribe.html">Subscribe</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="footer-heading">Company</h4>
                    <ul class="footer-links">
                        <li><a href="about.html">Who is she?</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="careers.html">Careers</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="footer-heading">Newsletter</h4>
                    <p class="newsletter-text">Subscribe for the latest updates.</p>
                    <form class="newsletter-form" onsubmit="event.preventDefault(); alert('Template demo: Subscribed!');">
                        <input type="email" placeholder="Your email address" class="newsletter-input" required>
                        <button type="submit" class="btn-subscribe">Subscribe</button>
                    </form>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Mudiera. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const grid = document.getElementById('businessGrid');
            const searchInput = document.getElementById('searchInput');
            const categoryFilters = document.getElementById('categoryFilters');
            const subcategoryWrapper = document.getElementById('subcategoryWrapper');
            const subcategoryFilter = document.getElementById('subcategoryFilter');
            const pills = categoryFilters ? categoryFilters.querySelectorAll('.pill') : [];
            const searchBtn = document.querySelector('.search-btn');

            // Define Subcategories Taxonomy
            const subcategories = {
                'Health & Beauty': [
                    { name: 'Hijama & Cupping', keywords: ['hijama', 'cupping', 'wet cupping', 'dry cupping'] },
                    { name: 'Spa & Massage', keywords: ['spa', 'massage', 'hammam', 'sauna', 'relax'] },
                    { name: 'Skincare', keywords: ['skin', 'face', 'facial', 'serum', 'oil', 'cream', 'balm'] },
                    { name: 'Hair & Salon', keywords: ['hair', 'salon', 'cut', 'style', 'colour', 'dye'] },
                    { name: 'Makeup', keywords: ['makeup', 'cosmetic', 'lipstick', 'foundation', 'beauty'] },
                    { name: 'Fitness & Swimming', keywords: ['swim', 'pool', 'gym', 'fitness', 'yoga', 'pilates'] }
                ],
                'Food & Drinks': [
                    { name: 'Restaurants', keywords: ['restaurant', 'dining', 'grill', 'curry', 'indian', 'persian', 'cuisine'] },
                    { name: 'Cafes & Tea', keywords: ['cafe', 'coffee', 'tea', 'latte', 'breakfast', 'brunch'] },
                    { name: 'Bakery & Desserts', keywords: ['bakery', 'cake', 'dessert', 'pastry', 'sweet', 'cookie'] },
                    { name: 'Fast Food', keywords: ['burger', 'chicken', 'chips', 'pizza', 'fast food'] }
                ],
                'Shopping': [
                    { name: 'Halal Meat', keywords: ['meat', 'butcher', 'poultry', 'lamb', 'beef'] },
                    { name: 'Fashion & Clothing', keywords: ['clothing', 'abaya', 'hijab', 'dress', 'fashion', 'wear'] },
                    { name: 'Gifts & Home', keywords: ['gift', 'candle', 'home', 'decor', 'scent'] }
                ],
                'Services': [
                    { name: 'Financial', keywords: ['accountant', 'tax', 'finance', 'money'] },
                    { name: 'Events & Catering', keywords: ['catering', 'event', 'wedding', 'party', 'decor'] },
                    { name: 'Professional', keywords: ['consult', 'design', 'web', 'marketing', 'legal'] }
                ],
                'Travel': [
                    { name: 'Retreats', keywords: ['retreat', 'wellness', 'getaway'] },
                    { name: 'Tours & Guides', keywords: ['tour', 'guide', 'walk', 'sightseeing'] },
                    { name: 'Group Travel', keywords: ['group', 'trip', 'adventure'] }
                ]
            };

            function updateSubcategories(category) {
                // Clear existing options
                subcategoryFilter.innerHTML = '<option value="">All Subcategories</option>';
                
                if (subcategories[category]) {
                    subcategoryWrapper.classList.add('visible');
                    subcategories[category].forEach(sub => {
                        const option = document.createElement('option');
                        option.value = sub.name;
                        option.textContent = sub.name;
                        option.dataset.keywords = JSON.stringify(sub.keywords);
                        subcategoryFilter.appendChild(option);
                    });
                } else {
                    subcategoryWrapper.classList.remove('visible');
                }
            }

            function mapCategory(sourceCategory) {
                if (sourceCategory === 'Fashion & Clothing') return 'Shopping';
                if (sourceCategory === 'Coaching') return 'Services';
                if (sourceCategory === 'Female Fitness') return 'Services';
                if (sourceCategory === 'Travel & Tourism') return 'Services';
                if (sourceCategory === 'Travel') return 'Services';
                if (sourceCategory === 'Community & Education') return 'Community';
                return sourceCategory;
            }

            function createCard(business) {
                const article = document.createElement('article');
                article.className = 'card';
                const mappedCategory = mapCategory(business.category);
                
                article.innerHTML = `
                    <div class="card-body">
                        <span class="card-meta">${mappedCategory}</span>
                        <h3 class="card-title">
                            <a href="profile.html?id=${encodeURIComponent(business.id)}">${business.name}</a>
                        </h3>
                        <p class="card-text">${business.description}</p>
                        <div class="card-footer">
                            <svg class="icon-loc" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                            </svg>
                            <span>${business.location}</span>
                        </div>
                    </div>
                `;
                return article;
            }

            function renderBusinesses(businesses) {
                if (!grid) return;
                grid.innerHTML = '';
                businesses.forEach(business => {
                    grid.appendChild(createCard(business));
                });
            }

            function filterBusinesses() {
                if (!grid) return;
                const cards = grid.querySelectorAll('.card');
                const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
                
                let activeCategory = 'All';
                if (categoryFilters) {
                    const activePill = categoryFilters.querySelector('.pill.active');
                    if (activePill) activeCategory = activePill.textContent.trim();
                }

                // Subcategory Logic
                let matchesSubcategory = true;
                let subKeywords = [];
                let selectedSubValue = '';
                
                if (subcategoryFilter) {
                    selectedSubValue = subcategoryFilter.value;
                    if (selectedSubValue && subcategoryFilter.selectedIndex >= 0) {
                         const selectedSubOption = subcategoryFilter.options[subcategoryFilter.selectedIndex];
                         if (selectedSubOption && selectedSubOption.dataset.keywords) {
                             try {
                                subKeywords = JSON.parse(selectedSubOption.dataset.keywords);
                             } catch (e) {
                                console.error('Error parsing keywords', e);
                             }
                         }
                    }
                }

                cards.forEach(card => {
                    const title = card.querySelector('.card-title').textContent.toLowerCase();
                    const meta = card.querySelector('.card-meta').textContent;
                    const text = card.querySelector('.card-text').textContent.toLowerCase();
                    const footerSpan = card.querySelector('.card-footer span');
                    const location = footerSpan ? footerSpan.textContent.toLowerCase() : '';

                    // 1. Search Filter
                    const matchesSearch = title.includes(searchTerm) || 
                                          text.includes(searchTerm) || 
                                          location.includes(searchTerm);
                    
                    // 2. Category Filter
                    const matchesCategory = activeCategory === 'All' || meta === activeCategory;

                    // 3. Subcategory Filter (Keyword Matching)
                    if (selectedSubValue && subKeywords.length > 0) {
                        const content = (title + ' ' + text).toLowerCase();
                        matchesSubcategory = subKeywords.some(keyword => content.includes(keyword.toLowerCase()));
                    } else {
                        matchesSubcategory = true;
                    }

                    if (matchesSearch && matchesCategory && matchesSubcategory) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            }

            if (searchInput) {
                searchInput.addEventListener('input', filterBusinesses);
                searchInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        filterBusinesses();
                        searchInput.blur();
                    }
                });
            }

            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    filterBusinesses();
                    // Optional: Visual feedback or scroll
                });
            }

            if (subcategoryFilter) {
                subcategoryFilter.addEventListener('change', filterBusinesses);
            }

            pills.forEach(pill => {
                pill.addEventListener('click', function() {
                    pills.forEach(p => p.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update Subcategories based on selection
                    const category = this.textContent.trim();
                    updateSubcategories(category);
                    
                    filterBusinesses();
                });
            });

            // Check for category URL param
            const urlParams = new URLSearchParams(window.location.search);
            const initialCategory = urlParams.get('category');
            if (initialCategory) {
                pills.forEach(pill => {
                    if (pill.textContent.trim() === initialCategory) {
                        pills.forEach(p => p.classList.remove('active'));
                        pill.classList.add('active');
                        updateSubcategories(initialCategory); // Ensure subcats load
                    }
                });
            }

            // Load from global variable (businesses_data.js) to support local file opening
            function loadBusinesses() {
                try {
                    if (window.businessData) {
                        const data = window.businessData;
                        const list = data.businesses || data;
                        const businesses = list.map(item => ({
                            id: item.id,
                            name: item.name || item['Brand Name'],
                            category: item.category || item['Category'] || 'Health & Beauty',
                            description: item.description || item['Description / Speciality'] || '',
                            location: item.location || item['Location'] || 'London',
                            contact: item.contact || '',
                            source: item.source || '',
                            website: item.website || '',
                            instagram: item.instagram || ''
                        }));
                        renderBusinesses(businesses);
                        filterBusinesses();
                    } else {
                        // Fallback to fetch if variable missing (unlikely if script included)
                        fetch('businesses.json?v=3')
                            .then(response => response.json())
                            .then(data => {
                                const list = data.businesses || data;
                                // ... same mapping ...
                                const businesses = list.map(item => ({
                                    id: item.id,
                                    name: item.name,
                                    category: item.category,
                                    description: item.description,
                                    location: item.location
                                }));
                                renderBusinesses(businesses);
                                filterBusinesses();
                            })
                            .catch(e => console.error(e));
                    }
                } catch (error) {
                    console.error('Error loading businesses data:', error);
                    if (grid) grid.innerHTML = '<p class="error-msg">Unable to load directory listings. Please try again later.</p>';
                }
            }

            loadBusinesses();

            // Mobile Navigation Toggle
            const navToggle = document.querySelector('.nav-toggle');
            const mainNav = document.querySelector('.main-nav');
            if (navToggle && mainNav) {
                navToggle.addEventListener('click', function() {
                    mainNav.classList.toggle('active');
                });
            }
        });
    </script>

    <script src="launch-timer.js"></script>
</body>
</html>


